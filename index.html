<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTV Telecom Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        [data-view] { display: none; }
        .view-visible { display: block; }
        #timer-bar-inner {
            transition: width 1s linear;
        }
        .correct-answer { animation: flash-green 0.7s ease; }
        .incorrect-answer { animation: flash-red 0.7s ease; }
        @keyframes flash-green {
            0%, 100% { background-color: #10B981; }
            50% { background-color: #34D399; }
        }
        @keyframes flash-red {
            0%, 100% { background-color: #EF4444; }
            50% { background-color: #F87171; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">

    <div id="app-container" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-md">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <span class="font-bold text-xl text-blue-600">PTV Quiz</span>
                    </div>
                    <div class="hidden md:block">
                        <div id="nav-links" class="ml-10 flex items-baseline space-x-4">
                            <!-- Nav links will be injected here -->
                        </div>
                    </div>
                    <div id="auth-area" class="flex items-center space-x-4">
                        <!-- Auth info will be injected here -->
                    </div>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">

            <!-- View: Loading -->
            <div id="view-loading" data-view class="text-center">
                <p class="text-lg">Cargando...</p>
            </div>

            <!-- View: Config -->
            <div id="view-config" data-view>
                <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-center">Configuraci√≥n Inicial</h2>
                    <p class="text-gray-600 mb-6 text-center">Pega la URL de tu Web App de Google Apps Script para conectar.</p>
                    <form id="config-form">
                        <label for="web-app-url" class="block text-sm font-medium text-gray-700">Web App URL</label>
                        <input type="url" id="web-app-url" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <button type="submit" class="mt-6 w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Guardar y Continuar</button>
                    </form>
                </div>
            </div>

            <!-- View: Auth -->
            <div id="view-auth" data-view>
                <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg text-center">
                     <h2 class="text-2xl font-bold mb-4">Bienvenido al Quiz de PTV</h2>
                     <p class="text-gray-600 mb-6">Por favor, inicia sesi√≥n para continuar.</p>
                     <div id="google-signin-button" class="flex justify-center"></div>
                </div>
            </div>
            
            <!-- View: Profile Gate -->
            <div id="view-profile" data-view>
                 <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-center">Completa tu Perfil</h2>
                    <p class="text-gray-600 mb-6 text-center">Necesitamos algunos datos antes de que puedas jugar.</p>
                    <form id="profile-form" class="space-y-4">
                        <div>
                            <label for="display-name" class="block text-sm font-medium text-gray-700">Nombre a mostrar</label>
                            <input type="text" id="display-name" required minlength="2" maxlength="24" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="delegacion-code" class="block text-sm font-medium text-gray-700">Delegaci√≥n</label>
                             <select id="delegacion-code" required class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <option value="" disabled selected>Selecciona tu delegaci√≥n</option>
                                <option value="01">01 MADRID</option>
                                <option value="02">02 CORDOBA</option>
                                <option value="03">03 SEVILLA</option>
                                <option value="04">04 MALAGA</option>
                                <option value="05">05 VALENCIA</option>
                                <option value="07">07 GRANADA</option>
                                <option value="08">08 ALMERIA</option>
                                <option value="09">09 LINARES</option>
                                <option value="10">10 JAEN</option>
                                <option value="11">11 ALICANTE</option>
                                <option value="12">12 ELCHE</option>
                            </select>
                        </div>
                        <div>
                            <label for="codigo-comercial" class="block text-sm font-medium text-gray-700">C√≥digo Comercial</label>
                            <input type="text" id="codigo-comercial" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <p id="profile-error" class="text-red-500 text-sm hidden"></p>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">Guardar Perfil</button>
                    </form>
                </div>
            </div>

            <!-- View: Home -->
            <div id="view-home" data-view class="text-center">
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-3xl font-bold mb-4">¬°Hola, <span id="home-username"></span>!</h2>
                    <p class="text-gray-600 mb-8 text-lg">¬øListo para demostrar tus conocimientos sobre PTV Telecom?</p>
                    <button id="start-quiz-btn-home" class="bg-green-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-600 transition-transform transform hover:scale-105 text-xl">
                        ¬°Jugar Ahora!
                    </button>
                </div>
            </div>

            <!-- View: Play Start -->
            <div id="view-play-start" data-view class="text-center">
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                     <h2 class="text-3xl font-bold mb-4">Selecciona un Quiz</h2>
                     <p class="text-gray-600 mb-8">Elige una categor√≠a para empezar a jugar.</p>
                     <div class="space-y-4">
                         <button id="start-fortalezas-btn" class="w-full max-w-sm bg-blue-600 text-white font-bold py-4 px-6 rounded-lg hover:bg-blue-700 text-lg">Fortalezas de PTV</button>
                         <!-- More categories can be added here -->
                     </div>
                </div>
            </div>

            <!-- View: Quiz -->
            <div id="view-quiz" data-view>
                <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg">
                    <!-- Quiz Header -->
                    <div class="flex justify-between items-center mb-4 text-sm">
                        <div class="font-semibold">Pregunta <span id="question-current-num">1</span> de <span id="question-total-num">10</span></div>
                        <div class="flex space-x-4">
                            <div class="font-bold">Puntos: <span id="quiz-score" class="text-green-600">0</span></div>
                            <div class="font-bold">Racha: <span id="quiz-streak" class="text-yellow-500">x0</span></div>
                        </div>
                    </div>
                    <!-- Timer Bar -->
                    <div id="timer-bar" class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                        <div id="timer-bar-inner" class="bg-blue-500 h-2.5 rounded-full" style="width: 100%"></div>
                    </div>
                    <!-- Question -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-6 min-h-[100px]">
                        <p id="question-text" class="text-lg font-semibold text-center"></p>
                    </div>
                    <!-- Answers -->
                    <div id="answers-container" class="space-y-3">
                        <!-- Answer options will be injected here -->
                    </div>
                     <div id="answer-feedback" class="mt-4 text-center font-bold"></div>
                </div>
            </div>
            
            <!-- View: Quiz End -->
            <div id="view-quiz-end" data-view>
                 <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg text-center">
                    <h2 class="text-4xl font-extrabold mb-2">¬°Partida Terminada!</h2>
                    <p class="text-gray-600 mb-6 text-lg">Tu puntuaci√≥n final es:</p>
                    <div id="final-score" class="text-6xl font-bold text-blue-600 mb-8">0</div>
                    
                    <h3 class="text-xl font-bold mb-4">Top 10 (√öltimos 30 d√≠as)</h3>
                    <div id="end-game-leaderboard" class="text-left mb-8">
                        <!-- Mini leaderboard here -->
                    </div>
                    
                    <div class="flex justify-center space-x-4">
                        <button id="play-again-btn" class="bg-green-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-600">Jugar otra vez</button>
                        <button id="view-ranking-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600">Ver Ranking</button>
                    </div>
                 </div>
            </div>

            <!-- View: Leaderboard -->
            <div id="view-leaderboard" data-view>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-6 text-center">üèÜ Ranking (√öltimos 30 d√≠as) üèÜ</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pos.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Delegaci√≥n</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Partidas</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Puntos</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body" class="bg-white divide-y divide-gray-200">
                                <!-- Leaderboard rows will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
             <!-- View: Admin -->
            <div id="view-admin" data-view>
                <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 text-center">Panel de Administraci√≥n</h2>
                    <div id="admin-content">
                        <p class="text-gray-600 mb-6">Aqu√≠ puedes realizar tareas de administraci√≥n.</p>
                        <button id="import-questions-btn" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Cargar 100 'Fortalezas de PTV' (auto)</button>
                        <p id="import-status" class="mt-4 text-center"></p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modal for confirmations -->
    <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
      <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
          <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Confirmaci√≥n</h3>
          <div class="mt-2 px-7 py-3">
            <p class="text-sm text-gray-500" id="modal-body"></p>
          </div>
          <div class="items-center px-4 py-3">
            <button id="modal-confirm" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300">
              Confirmar
            </button>
            <button id="modal-cancel" class="px-4 py-2 bg-gray-200 text-gray-900 text-base font-medium rounded-md w-auto ml-2 shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300">
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>


    <script>
    // --- START OF SCRIPT ---
    (function() {
        // --- STATE MANAGEMENT ---
        let state = {
            idToken: null,
            webAppUrl: null,
            userProfile: null,
            currentView: 'loading',
            quiz: {
                questions: [],
                currentQuestionIndex: 0,
                score: 0,
                streak: 0,
                sessionId: null,
                timer: null,
                startTime: null,
            },
        };
        let views;
        const QUIZ_TIME_LIMIT = 20; // seconds

        // --- DOM ELEMENTS ---
        const navLinksContainer = document.getElementById('nav-links');
        const authArea = document.getElementById('auth-area');

        // --- CORE APP LOGIC ---

        function init() {
            views = document.querySelectorAll('[data-view]');// <-- la hemos movido de la 278
            console.log("App initializing...");
            state.webAppUrl = localStorage.getItem('ptvQuizWebAppUrl');
            state.idToken = localStorage.getItem('ptvQuizIdToken');

            if (!state.webAppUrl) {
                showView('config');
            } else {
                setupGoogleSignIn();
                if (state.idToken) {
                    handleLoginSuccess();
                } else {
                    showView('auth');
                }
            }
            addEventListeners();
        }

        function showView(viewId) {
            console.log(`Switching to view: ${viewId}`);
            state.currentView = viewId;
            views.forEach(view => {
                if (view.id === viewId) {
                    view.classList.add('view-visible', 'fade-in');
                } else {
                    view.classList.remove('view-visible');
                }
            });
            updateNavActiveState(viewId);
        }

        function setupGoogleSignIn() {
             google.accounts.id.initialize({
                client_id: '24633684161-2q1p4rd0ng0d170kkrkjkl3d0svk63kb.apps.googleusercontent.com', // This will be provided automatically by the environment
                callback: handleCredentialResponse
            });
            google.accounts.id.renderButton(
                document.getElementById("google-signin-button"),
                { theme: "outline", size: "large" }
            );
        }

        async function handleCredentialResponse(response) {
            console.log("Received credential response from Google.");
            state.idToken = response.credential;
            localStorage.setItem('ptvQuizIdToken', state.idToken);
            await handleLoginSuccess();
        }

        async function handleLoginSuccess() {
            showView('loading');
            try {
                const profile = await fetchAPI('/me');
                state.userProfile = profile;
                updateAuthUI();

                if (!profile || !profile.display_name || !profile.delegacion_code || !profile.codigo_comercial) {
                    console.log("User profile incomplete. Showing profile gate.");
                    document.getElementById('display-name').value = profile?.display_name || '';
                    document.getElementById('codigo-comercial').value = profile?.codigo_comercial || '';
                    document.getElementById('delegacion-code').value = profile?.delegacion_code || '';
                    showView('profile');
                } else {
                    console.log("User profile complete. Welcome!");
                    document.getElementById('home-username').textContent = profile.display_name;
                    showView('home');
                }
            } catch (error) {
                console.error("Error fetching user profile:", error);
                if (error.message.includes('401')) {
                    alert('Error de autenticaci√≥n. Es posible que no pertenezcas al dominio permitido (@ptvtelecom.com).');
                    logout();
                } else {
                    alert('Error al contactar con el servidor. Revisa la URL de la Web App en Configuraci√≥n.');
                    showView('config');
                }
            }
        }
        
        function updateAuthUI() {
            navLinksContainer.innerHTML = '';
            authArea.innerHTML = '';
            
            if (state.userProfile) {
                const links = [
                    { id: 'home', text: 'Inicio' },
                    { id: 'play-start', text: 'Jugar' },
                    { id: 'leaderboard', text: 'Ranking' },
                ];
                if (state.userProfile.rol === 'admin' || state.userProfile.rol === 'supervisor') {
                    links.push({ id: 'admin', text: 'Admin' });
                }
                links.push({ id: 'config', text: 'Config' });
                
                links.forEach(link => {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.dataset.view = link.id;
                    a.textContent = link.text;
                    a.className = 'text-gray-500 hover:bg-gray-100 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium nav-link';
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        navigateTo(link.id);
                    });
                    navLinksContainer.appendChild(a);
                });
                
                authArea.innerHTML = `
                    <span class="text-sm text-gray-600">${state.userProfile.auth_email}</span>
                    <button id="logout-btn" class="bg-red-500 text-white px-3 py-1 rounded-md text-sm font-medium hover:bg-red-600">Salir</button>
                `;
                document.getElementById('logout-btn').addEventListener('click', logout);

            }
        }
        
        function updateNavActiveState(viewId) {
            document.querySelectorAll('.nav-link').forEach(link => {
                if(link.dataset.view === viewId) {
                    link.classList.add('bg-gray-200', 'text-gray-900');
                    link.classList.remove('text-gray-500');
                } else {
                    link.classList.remove('bg-gray-200', 'text-gray-900');
                    link.classList.add('text-gray-500');
                }
            });
        }
        
        async function navigateTo(viewId) {
            switch(viewId) {
                case 'leaderboard':
                    await loadLeaderboard();
                    break;
                // other views might need data loading here
            }
            showView(viewId);
        }

        function logout() {
            console.log("Logging out.");
            state.idToken = null;
            state.userProfile = null;
            localStorage.removeItem('ptvQuizIdToken');
            google.accounts.id.disableAutoSelect();
            // We don't reload to allow user to see they are logged out.
            authArea.innerHTML = '';
            navLinksContainer.innerHTML = '';
            showView('auth');
        }

        // --- API CLIENT ---
        async function fetchAPI(endpoint, options = {}) {
            const url = `${state.webAppUrl}?path=${endpoint.substring(1)}`;
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers,
            };
            if (state.idToken) {
                headers['Authorization'] = `Bearer ${state.idToken}`;
            }

            const config = {
                method: options.method || 'GET',
                headers,
                body: options.body ? JSON.stringify(options.body) : null,
                redirect: 'follow',
                mode: 'cors',
            };
            
            // For POST requests, GAS needs a specific structure
            if (config.method === 'POST') {
                // The URL already contains the path, body is what needs to be sent
                // GAS doPost(e) will handle parsing e.postData.contents
            }

            console.log(`Fetching API: ${config.method} ${url}`);
            const response = await fetch(url, config);

            if (!response.ok) {
                const errorText = await response.text();
                console.error(`API Error ${response.status}:`, errorText);
                throw new Error(`API Error ${response.status}: ${errorText}`);
            }

            const data = await response.json();
            return data;
        }

        // --- EVENT LISTENERS & HANDLERS ---
        function addEventListeners() {
            document.getElementById('config-form').addEventListener('submit', handleConfigSave);
            document.getElementById('profile-form').addEventListener('submit', handleProfileSave);
            document.getElementById('start-quiz-btn-home').addEventListener('click', () => showView('play-start'));
            document.getElementById('start-fortalezas-btn').addEventListener('click', () => startQuiz('Fortalezas de PTV'));
            document.getElementById('play-again-btn').addEventListener('click', () => showView('play-start'));
            document.getElementById('view-ranking-btn').addEventListener('click', () => navigateTo('leaderboard'));
            document.getElementById('import-questions-btn').addEventListener('click', handleImportQuestions);
        }
        
        function handleConfigSave(e) {
            e.preventDefault();
            const urlInput = document.getElementById('web-app-url');
            let url = urlInput.value.trim();
            if (url) {
                if (!url.endsWith('exec')) {
                    url += (url.endsWith('/') ? '' : '/') + 'exec';
                }
                state.webAppUrl = url;
                localStorage.setItem('ptvQuizWebAppUrl', url);
                console.log("Web App URL saved.");
                init(); // Re-initialize the app with the new URL
            }
        }
        
        async function handleProfileSave(e) {
            e.preventDefault();
            const displayName = document.getElementById('display-name').value;
            const delegacionCode = document.getElementById('delegacion-code').value;
            const codigoComercial = document.getElementById('codigo-comercial').value;
            const errorEl = document.getElementById('profile-error');

            const validationError = validateDisplayName(displayName);
            if(validationError) {
                errorEl.textContent = validationError;
                errorEl.classList.remove('hidden');
                return;
            }
            errorEl.classList.add('hidden');

            const profileData = {
                display_name: displayName,
                delegacion_code: delegacionCode,
                codigo_comercial: codigoComercial,
            };
            
            try {
                showView('loading');
                const updatedProfile = await fetchAPI('/saveProfile', { method: 'POST', body: profileData });
                state.userProfile = updatedProfile;
                await handleLoginSuccess(); // Re-run the logic to ensure UI is updated and move to home
            } catch (error) {
                console.error("Error saving profile:", error);
                alert("Hubo un error al guardar tu perfil. Int√©ntalo de nuevo.");
                showView('profile');
                
            }
        }
        
        // --- QUIZ LOGIC ---
        
        async function startQuiz(category) {
            showView('loading');
            try {
                const allQuestions = await fetchAPI(`/questions?categoria=${encodeURIComponent(category)}`);
                if (allQuestions.length < 10) {
                    alert('No hay suficientes preguntas en esta categor√≠a para empezar un quiz.');
                    showView('play-start');
                    return;
                }
                
                // Shuffle and pick 10
                state.quiz.questions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, 10);
                state.quiz.currentQuestionIndex = 0;
                state.quiz.score = 0;
                state.quiz.streak = 0;
                
                const session = await fetchAPI('/startSession', { method: 'POST', body: { categoria: category }});
                state.quiz.sessionId = session.session_id;
                state.quiz.startTime = new Date();

                showView('quiz');
                displayCurrentQuestion();

            } catch (error) {
                console.error("Failed to start quiz:", error);
                alert("No se pudo iniciar el quiz. Int√©ntalo de nuevo.");
                showView('play-start');
            }
        }

        function displayCurrentQuestion() {
            const quiz = state.quiz;
            const question = quiz.questions[quiz.currentQuestionIndex];
            
            document.getElementById('question-current-num').textContent = quiz.currentQuestionIndex + 1;
            document.getElementById('question-total-num').textContent = quiz.questions.length;
            document.getElementById('quiz-score').textContent = quiz.score;
            document.getElementById('quiz-streak').textContent = `x${quiz.streak}`;
            document.getElementById('question-text').textContent = question.enunciado;
            document.getElementById('answer-feedback').textContent = '';

            const answersContainer = document.getElementById('answers-container');
            answersContainer.innerHTML = '';

            switch(question.tipo) {
                case 'vof':
                case 'mcq': // Assuming mcq and vof use options_json
                    const options = JSON.parse(question.opciones_json);
                    options.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.textContent = option;
                        button.dataset.index = index;
                        button.className = 'block w-full text-left p-4 border border-gray-300 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-400';
                        button.addEventListener('click', () => handleAnswer(index, option));
                        answersContainer.appendChild(button);
                    });
                    break;
                case 'abierta':
                    const form = document.createElement('form');
                    form.innerHTML = `
                        <input type="text" id="open-answer-input" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" placeholder="Escribe tu respuesta...">
                        <button type="submit" class="mt-3 w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">Enviar</button>
                    `;
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const input = document.getElementById('open-answer-input');
                        handleAnswer(-1, input.value.trim());
                    });
                    answersContainer.appendChild(form);
                    document.getElementById('open-answer-input').focus();
                    break;
            }
            startTimer();
        }

        function startTimer() {
            clearTimeout(state.quiz.timer);
            const timerBar = document.getElementById('timer-bar-inner');
            timerBar.style.transition = 'none';
            timerBar.style.width = '100%';
            
            // Force reflow to restart animation
            void timerBar.offsetWidth;

            timerBar.style.transition = `width ${QUIZ_TIME_LIMIT}s linear`;
            timerBar.style.width = '0%';
            
            state.quiz.timer = setTimeout(() => {
                handleAnswer(-1, null, true); // Time's up
            }, QUIZ_TIME_LIMIT * 1000);
        }

        async function handleAnswer(selectedIndex, selectedText, isTimeout = false) {
            clearTimeout(state.quiz.timer);
            
            const question = state.quiz.questions[state.quiz.currentQuestionIndex];
            const feedbackEl = document.getElementById('answer-feedback');
            
            let isCorrect = false;
            let points = -60;
            let newStreak = 0;
            
            if (!isTimeout) {
                if (question.tipo === 'abierta') {
                    isCorrect = normalizeText(selectedText) === normalizeText(question.correcta_text);
                } else {
                    isCorrect = selectedIndex == question.correcta_idx;
                }
            }

            if(isCorrect) {
                const timerBarWidth = document.getElementById('timer-bar-inner').offsetWidth;
                const totalBarWidth = document.getElementById('timer-bar').offsetWidth;
                const timeBonus = Math.floor(50 * (timerBarWidth / totalBarWidth));
                
                newStreak = state.quiz.streak + 1;
                const streakBonus = Math.min(50, newStreak * 10);
                
                points = 100 + timeBonus + streakBonus;
                state.quiz.score += points;
                state.quiz.streak = newStreak;
                feedbackEl.textContent = `¬°Correcto! +${points} puntos`;
                feedbackEl.className = 'mt-4 text-center font-bold text-green-600';
            } else {
                state.quiz.score += points;
                state.quiz.streak = 0;
                 if (isTimeout) {
                    feedbackEl.textContent = `¬°Tiempo agotado! ${points} puntos`;
                } else {
                    feedbackEl.textContent = `Incorrecto. ${points} puntos`;
                }
                feedbackEl.className = 'mt-4 text-center font-bold text-red-600';
            }
            
            // Highlight correct/incorrect options visually
            const buttons = document.querySelectorAll('#answers-container button[data-index]');
            buttons.forEach(button => {
                button.disabled = true;
                const buttonIndex = button.dataset.index;
                if (buttonIndex == question.correcta_idx) {
                    button.classList.add('bg-green-500', 'text-white', 'border-green-500');
                } else if (buttonIndex == selectedIndex) {
                    button.classList.add('bg-red-500', 'text-white', 'border-red-500');
                }
            });
            
            document.getElementById('quiz-score').textContent = state.quiz.score;
            document.getElementById('quiz-streak').textContent = `x${state.quiz.streak}`;
            
            try {
                await fetchAPI('/answer', {
                    method: 'POST',
                    body: {
                        session_id: state.quiz.sessionId,
                        question_id: question.id,
                        correcta: isCorrect,
                        tiempo_respuesta_ms: 1000, // Placeholder, can be calculated more accurately
                        puntos: points,
                        seleccion_idx: selectedIndex,
                        respuesta_text: selectedText
                    }
                });
            } catch (error) {
                console.error("Failed to save answer:", error);
            }

            setTimeout(nextQuestionOrEnd, 2000);
        }

        function nextQuestionOrEnd() {
            if (state.quiz.currentQuestionIndex < state.quiz.questions.length - 1) {
                state.quiz.currentQuestionIndex++;
                displayCurrentQuestion();
            } else {
                endQuiz();
            }
        }

        async function endQuiz() {
            showView('loading');
            const duration = new Date() - state.quiz.startTime;

            try {
                await fetchAPI('/endSession', {
                    method: 'POST',
                    body: {
                        session_id: state.quiz.sessionId,
                        score: state.quiz.score,
                        duracion_ms: duration,
                    }
                });

                document.getElementById('final-score').textContent = state.quiz.score;
                
                // Fetch mini leaderboard for end screen
                const leaderboardData = await fetchAPI('/leaderboard');
                const miniLeaderboardContainer = document.getElementById('end-game-leaderboard');
                miniLeaderboardContainer.innerHTML = leaderboardData.slice(0, 5).map((entry, index) => `
                    <div class="flex justify-between p-2 ${index % 2 === 0 ? 'bg-gray-50' : ''} rounded">
                        <span>${index + 1}. ${entry.display_name}</span>
                        <span class="font-bold">${entry.total_score}</span>
                    </div>
                `).join('');
                
                showView('quiz-end');

            } catch (error) {
                console.error("Failed to end quiz session:", error);
                alert("Hubo un error al finalizar la partida.");
                showView('home');
            }
        }
        
        // --- LEADERBOARD ---
        async function loadLeaderboard() {
            try {
                const leaderboardData = await fetchAPI('/leaderboard');
                const tbody = document.getElementById('leaderboard-body');
                if (leaderboardData.length === 0) {
                     tbody.innerHTML = `<tr><td colspan="5" class="text-center p-4">No hay datos de ranking todav√≠a. ¬°Juega una partida para aparecer aqu√≠!</td></tr>`;
                     return;
                }
                tbody.innerHTML = leaderboardData.map((entry, index) => `
                    <tr class="${index === 0 ? 'bg-yellow-100' : (index === 1 ? 'bg-gray-200' : (index === 2 ? 'bg-orange-100' : ''))}">
                        <td class="px-6 py-4 whitespace-nowrap font-bold">${index + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${entry.display_name}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${entry.delegacion_code}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${entry.games_played}</td>
                        <td class="px-6 py-4 whitespace-nowrap font-bold">${entry.total_score}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error("Failed to load leaderboard:", error);
                document.getElementById('leaderboard-body').innerHTML = `<tr><td colspan="5" class="text-center text-red-500 p-4">Error al cargar el ranking.</td></tr>`;
            }
        }

        // --- ADMIN ---
        function handleImportQuestions() {
            showModal(
                '¬øEst√°s seguro de que quieres cargar las 100 preguntas de "Fortalezas de PTV"? Esto puede a√±adir duplicados si ya existen.',
                async () => {
                    const btn = document.getElementById('import-questions-btn');
                    const statusEl = document.getElementById('import-status');
                    btn.disabled = true;
                    btn.textContent = 'Importando...';
                    statusEl.textContent = 'Enviando datos al servidor...';
                    
                    try {
                        const result = await fetchAPI('/importAutoFortalezas', {
                            method: 'POST',
                            body: { questionsText: questionsToImport }
                        });
                        statusEl.textContent = `¬°√âxito! Se han importado ${result.imported} nuevas preguntas.`;
                        statusEl.className = 'mt-4 text-center text-green-600';
                    } catch (error) {
                         statusEl.textContent = `Error: ${error.message}`;
                         statusEl.className = 'mt-4 text-center text-red-600';
                    } finally {
                        btn.disabled = false;
                        btn.textContent = "Cargar 100 'Fortalezas de PTV' (auto)";
                    }
                }
            );
        }

        // --- UTILITY FUNCTIONS ---
        function validateDisplayName(name) {
            const normalized = name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            
            // Length check
            if (name.length < 2 || name.length > 24) return "El nombre debe tener entre 2 y 24 caracteres.";
            
            // Blacklist check
            const blacklist = ["puta", "puto", "mierda", "gilipoll", "cabron", "pendej", "co√±o", "hijoputa", "bastard", "imbecil", "racist", "nazi", "fascist", "maricon", "zorra", "perra"];
            if (blacklist.some(word => normalized.includes(word))) return "El nombre contiene palabras no permitidas.";
            
            // Company name check
            if (normalized.startsWith("ptv") || normalized.includes("zapi")) return "El nombre no puede contener 'PTV' o 'Zapi'.";
            
            // Format check
            if (/\d{9,}/.test(name)) return "El nombre no puede parecer un n√∫mero de tel√©fono.";
            if (/https?:\/\//.test(name) || /@/.test(name)) return "El nombre no puede contener URLs o handles.";

            return null; // No error
        }
        
        function normalizeText(text) {
            if (typeof text !== 'string') return '';
            return text.toLowerCase()
                .trim()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
        }

        function showModal(body, onConfirm) {
            const modal = document.getElementById('modal');
            document.getElementById('modal-body').textContent = body;
            
            const confirmBtn = document.getElementById('modal-confirm');
            const cancelBtn = document.getElementById('modal-cancel');

            const confirmHandler = () => {
                onConfirm();
                hideModal();
            };
            const cancelHandler = () => hideModal();

            // Clone to remove old listeners
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            newConfirmBtn.addEventListener('click', confirmHandler);

            const newCancelBtn = cancelBtn.cloneNode(true);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
            newCancelBtn.addEventListener('click', cancelHandler);

            modal.classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('modal').classList.add('hidden');
        }


        // --- START THE APP ---
        document.addEventListener('DOMContentLoaded', init);

    })();
    // --- END OF SCRIPT ---
    
    // Hardcoded question block for import
    const questionsToImport = `
### **Quiz Completo: Fortalezas y T√©cnicas de Venta de PTV Telecom**

#### **Secci√≥n 1: El Argumento Clave: Sin Permanencia**

1.  ¬øCu√°l es la principal raz√≥n que se argumenta por la que otras compa√±√≠as imponen permanencia?
    **Respuesta:** Porque no conf√≠an plenamente en la calidad de su servicio para que el cliente se quede por voluntad propia, o no se f√≠an del cliente.

2.  Seg√∫n el argumentario, si un t√©cnico tiene que atender a dos clientes con aver√≠a (uno con permanencia y otro sin ella), ¬øa cu√°l atender√° primero?
    **Respuesta:** Al que no tiene permanencia, porque es el que se puede ir en cualquier momento.

3.  ¬øQu√© se est√° garantizando un cliente, seg√∫n las fuentes, al firmar un contrato de permanencia?
    **Respuesta:** Un peor servicio durante toda la vida del contrato.

4.  **Verdadero o Falso:** PTV Telecom ha tenido, tiene y tendr√° siempre contratos de permanencia.
    **Respuesta:** Falso.

5.  La ausencia de permanencia en PTV es una prueba de ______ en la calidad de su servicio.
    **Respuesta:** Confianza.

6.  ¬øQu√© obliga a PTV a dar siempre el mejor servicio y la mejor atenci√≥n?
    **Respuesta:** El hecho de que sus clientes son libres de irse cuando quieran al no tener permanencia.

7.  **Completa la frase:** "Nuestros clientes est√°n con nosotros porque est√°n ______, no porque les aten".
    **Respuesta:** contentos.

8.  ¬øCu√°ntos usuarios se menciona que tiene PTV que se mantienen con la compa√±√≠a sin estar atados por permanencia?
    **Respuesta:** M√°s de un mill√≥n de usuarios.

9.  La filosof√≠a de no tener permanencia se basa en que el compromiso es de la empresa hacia el cliente, y no al rev√©s. ¬øQu√© analog√≠a se usa para explicar esto?
    **Respuesta:** La del panadero: nadie compra el pan repetidamente en el mismo sitio si no le gusta el pan.

10. ¬øC√≥mo se debe iniciar la conversaci√≥n sobre la permanencia con un cliente?
    **Respuesta:** Present√°ndola como una de las "grandes diferencias" de PTV frente a su compa√±√≠a actual.

#### **Secci√≥n 2: Calidad y Velocidad del Servicio**

11. ¬øQu√© porcentaje de la velocidad contratada garantiza PTV a sus clientes?
    **Respuesta:** El 100%.

12. ¬øC√≥mo demuestra PTV que el cliente recibe el 100% de la velocidad contratada?
    **Respuesta:** Con un test de velocidad realizado por el t√©cnico en el domicilio del cliente al finalizar la instalaci√≥n.

13. ¬øQu√© porcentaje de la velocidad garantizan por contrato otras compa√±√≠as, seg√∫n las fuentes?
    **Respuesta:** Mencionan porcentajes como el 70% o incluso el 50%.

14. ¬øCu√°ndo da PTV una instalaci√≥n por v√°lida?
    **Respuesta:** Solo cuando se comprueba que al cliente le llega el 100% de la velocidad contratada.

15. **Verdadero o Falso:** Para PTV es v√°lido que un cliente con 300 Mb reciba solo 150 Mb.
    **Respuesta:** Falso.

16. ¬øQu√© tecnolog√≠a de red de fibra √≥ptica utiliza PTV que la diferencia de la mayor√≠a?
    **Respuesta:** GPON 10.

17. ¬øQu√© ventaja clave tiene la red GPON 10 de PTV frente a la de otras dos compa√±√≠as que tambi√©n la instalan?
    **Respuesta:** PTV es la √∫nica que la tiene desplegada en toda su red, no solo en zonas concretas o "premium".

18. ¬øQu√© velocidad m√°xima permite la tecnolog√≠a GPON 10?
    **Respuesta:** Hasta 10 Gb.

19. ¬øQu√© se le debe decir a un cliente que cree que su compa√±√≠a actual (ej. Digi) tiene la mejor velocidad bas√°ndose en un estudio?
    **Respuesta:** Cuestionar sutilmente la validez del estudio, mencionando que solo mide a unas pocas compa√±√≠as y que PTV destaca en informes m√°s amplios como los de la OCU.

20. ¬øQu√© se le puede preguntar a un cliente veterano de Digi que dice tener 1 giga para evaluar la situaci√≥n?
    **Respuesta:** "¬øY c√≥mo lo sabe?" para ver si realiza tests de velocidad y qu√© resultados obtiene.

21. ¬øQu√© analog√≠a se usa para explicarle a un cliente que, aunque le lleguen 800 Mb y le parezca suficiente, est√° pagando por 1000 Mb?
    **Respuesta:** La de las patatas: si pagas por cinco patatas, te tienen que dar las cinco, aunque solo necesites tres para cocinar hoy.

22. **Completa la frase:** "Lo que paga es lo que recibe: ______ al 100%".
    **Respuesta:** garantizado.

23. ¬øLa red de PTV es propia o alquilada?
    **Respuesta:** Es una red propia.

24. ¬øEl equipamiento que PTV instala en casa del cliente (ONT) es propio o de la red que utiliza como base (ej. Orange en algunos casos)?
    **Respuesta:** Es propio de PTV, lo que afecta a la calidad final del servicio.

25. ¬øQu√© se hace en cada visita t√©cnica, incluso si no es por una aver√≠a de velocidad?
    **Respuesta:** Se vuelve a hacer un test de velocidad para seguir comprobando que llega el 100%.

#### **Secci√≥n 3: Atenci√≥n al Cliente y Servicio T√©cnico**

26. ¬øCu√°l es el horario del servicio t√©cnico y de atenci√≥n al cliente de PTV?
    **Respuesta:** 24 horas al d√≠a, 365 d√≠as al a√±o.

27. **Verdadero o Falso:** PTV es una de las muchas compa√±√≠as en Espa√±a que ofrecen servicio t√©cnico 24/7, incluyendo festivos.
    **Respuesta:** Falso.

28. Al llamar a PTV, ¬øcon qui√©n habla el cliente?
    **Respuesta:** Siempre con una persona real, nunca con un robot.

29. ¬øQu√© coste tiene para el cliente la reactivaci√≥n del servicio por un impago?
    **Respuesta:** Es gratuita.

30. ¬øCu√°nto cobran otras compa√±√≠as por la reconexi√≥n, seg√∫n las fuentes?
    **Respuesta:** Entre 20 y 30 ‚Ç¨.

31. ¬øPTV cuenta con oficinas f√≠sicas para la atenci√≥n al cliente?
    **Respuesta:** S√≠.

32. ¬øQu√© gestiones puede realizar un cliente en una oficina f√≠sica de PTV?
    **Respuesta:** Cualquier gesti√≥n, incluyendo pago de facturas, contrataci√≥n, configuraci√≥n del m√≥vil o resoluci√≥n de dudas t√©cnicas.

33. ¬øLos t√©cnicos de PTV son personal propio o de subcontratas?
    **Respuesta:** Son personal propio de la empresa.

34. ¬øQu√© significa el concepto de "t√©cnico de zona"?
    **Respuesta:** Que se asigna al cliente un t√©cnico que conoce la zona y que, a menudo, es la misma persona que le atiende siempre, generando confianza y cercan√≠a.

35. El "acompa√±amiento total al cliente" incluye resolver problemas que no son aver√≠as directas del servicio. Menciona dos ejemplos.
    **Respuesta:** Sintonizar un televisor nuevo, configurar un m√≥vil, ayudar a conectar unos radiadores a internet, formatear un ordenador, etc..

36. ¬øCu√°l es el tiempo medio de respuesta telef√≥nica que se menciona en las fuentes?
    **Respuesta:** Menos de 20 segundos para el 80% de las llamadas.

37. **Completa la frase:** "Aqu√≠ no hay letra peque√±a: hay ______ que responden".
    **Respuesta:** personas.

38. ¬øQu√© ventaja diferencial tiene la atenci√≥n telef√≥nica de PTV respecto a la transferencia de llamadas?
    **Respuesta:** La persona que atiende la llamada gestiona el caso hasta el final, sin transferir al cliente a otros departamentos.

39. Si un cliente tiene un problema un viernes por la tarde, ¬øcu√°ndo se le resolver√°?
    **Respuesta:** El mismo d√≠a o durante el fin de semana, a diferencia de otras compa√±√≠as que esperar√≠an al lunes.

40. **Verdadero o Falso:** La atenci√≥n 24/7 solo cubre aver√≠as, no consultas comerciales o administrativas.
    **Respuesta:** Falso.

#### **Secci√≥n 4: Reputaci√≥n y Confianza (OCU)**

41. ¬øQu√© organizaci√≥n independiente sit√∫a a PTV entre las compa√±√≠as mejor valoradas por los clientes?
    **Respuesta:** La OCU (Organizaci√≥n de Consumidores y Usuarios).

42. ¬øEn qu√© aspecto destaca especialmente PTV en las encuestas de la OCU?
    **Respuesta:** En la satisfacci√≥n del cliente y la atenci√≥n recibida.

43. Comparado con O2, ¬øc√≥mo posiciona la OCU a PTV?
    **Respuesta:** Por encima o en mejor posici√≥n.

44. **Verdadero o Falso:** El buen posicionamiento de PTV en la OCU se debe a una inversi√≥n en publicidad con dicha organizaci√≥n.
    **Respuesta:** Falso.

45. ¬øCu√°ntas compa√±√≠as de telecomunicaciones se incluyen en las encuestas de la OCU?
    **Respuesta:** Se mencionan 32 compa√±√≠as.

46. ¬øC√≥mo se puede usar el argumento de la OCU para reforzar la idea de la "no permanencia"?
    **Respuesta:** Explicando que la cultura de servicio excelente, obligada por la no permanencia, es lo que los clientes valoran y reflejan en las encuestas de la OCU.

47. ¬øQu√© tipo de consumidores forman la OCU, seg√∫n se describe en las formaciones?
    **Respuesta:** Consumidores exigentes, que pagan por estar asociados y miden mucho lo que reciben.

48. **Completa la frase:** "Si la OCU nos pone entre los primeros, es porque algo estamos haciendo ______".
    **Respuesta:** bien.

49. ¬øEl reconocimiento de la OCU es un hecho reciente o algo que se ha mantenido en el tiempo?
    **Respuesta:** Se ha mantenido durante los √∫ltimos 10 a√±os.

50. **Verdadero o Falso:** Para un cliente de Vodafone, se le puede indicar que su compa√±√≠a est√° en los √∫ltimos lugares en la encuesta de la OCU.
    **Respuesta:** Verdadero.

#### **Secci√≥n 5: Gesti√≥n de Competidores**

51. **Estrategia con un cliente de O2:** ¬øSe debe criticar a O2 para ganar al cliente?
    **Respuesta:** No. Se debe reconocer que O2 da un buen servicio y posicionar a PTV como una opci√≥n que ofrece lo mismo o m√°s, pero a un precio m√°s econ√≥mico.

52. ¬øPor qu√© un cliente suele estar con O2 en lugar de con una low-cost como Digi?
    **Respuesta:** Porque valora la calidad del servicio y no quiere renunciar a ella, aunque busque un precio m√°s bajo que el de Movistar.

53. **Estrategia con un cliente de Digi:** ¬øQu√© se debe hacer si menciona un estudio que dice que Digi tiene el mejor internet?
    **Respuesta:** No desacreditarlo directamente, sino plantear dudas sobre la metodolog√≠a del estudio (mide muy pocas compa√±√≠as) y compararlo con los informes de la OCU, donde PTV s√≠ destaca.

54. ¬øCu√°les son los puntos d√©biles de Digi que se pueden mencionar?
    **Respuesta:** La cobertura m√≥vil y la calidad de su servicio de televisi√≥n.

55. ¬øDigi tiene permanencia?
    **Respuesta:** S√≠, se menciona una permanencia de tres meses.

56. **Estrategia general con competidores m√°s baratos (ej. Digi):** ¬øEn qu√© se debe centrar el argumento?
    **Respuesta:** En los beneficios y el valor a√±adido (servicio t√©cnico, atenci√≥n 24/7, oficinas, garant√≠a de velocidad) que justifican la diferencia de precio.

57. ¬øC√≥mo se rebate la objeci√≥n de "Digi es m√°s barato"?
    **Respuesta:** Explicando que en Digi no tiene oficinas f√≠sicas, ni acompa√±amiento, ni configuraci√≥n de equipos. Se debe preguntar al cliente cu√°nto valora la tranquilidad de tener un servicio completo.

58. **Estrategia con un cliente de Vodafone:** ¬øQu√© punto d√©bil clave se puede explotar?
    **Respuesta:** El hecho de que suelen tener permanencia y que su servicio de atenci√≥n al cliente es deficiente (largas esperas, m√°quinas, problemas sin resolver).

59. **Verdadero o Falso:** La estrategia de venta es la misma para un cliente de O2 que para uno de Digi.
    **Respuesta:** Falso.

60. ¬øCu√°l es un diferenciador clave de PTV frente a todas las grandes operadoras (Movistar, Orange, Vodafone)?
    **Respuesta:** El modelo de gesti√≥n con red y personal propio, sin grandes campa√±as de publicidad, lo que permite un precio competitivo con un servicio de mayor calidad y cercan√≠a.

#### **Secci√≥n 6: La Oferta para Estudiantes**

61. ¬øCu√°l es la oferta principal de PTV dirigida a estudiantes?
    **Respuesta:** 2000 megas de velocidad m√°s televisi√≥n (Zapi) por 24,95‚Ç¨.

62. ¬øC√≥mo se justifica esta oferta frente a una m√°s barata de 9,95‚Ç¨ por 300 Mb que el estudiante haya podido ver?
    **Respuesta:** Explicando que 300 Mb es insuficiente para un piso con varios estudiantes y que el precio por mega en la oferta de 2000 Mb es hasta tres veces m√°s barato.

63. **Verdadero o Falso:** La oferta de 9,95‚Ç¨ es la recomendada para un piso de 4 estudiantes.
    **Respuesta:** Falso.

64. T√©cnicamente, ¬øc√≥mo se entregan los 2000 megas en la mayor√≠a de las instalaciones para estudiantes?
    **Respuesta:** A trav√©s de una ONT con dos puertos de 1 giga cada uno (1000 + 1000).

65. ¬øSe instala un decodificador de televisi√≥n por cable por defecto a los estudiantes?
    **Respuesta:** No, la televisi√≥n se ofrece a trav√©s de la plataforma Zapi (OTT) para evitar equipos adicionales.

66. ¬øCu√°ntos usuarios simult√°neos permite la plataforma Zapi en la oferta de estudiantes?
    **Respuesta:** Cuatro usuarios.

67. Si un estudiante insiste en que necesita los 2 gigas en una sola conexi√≥n (por ejemplo, para gaming competitivo), ¬øes posible instalarlo?
    **Respuesta:** S√≠, se puede instalar la ONT de 2 gigas y un mininodo si fuera necesario, aunque no es la opci√≥n por defecto.

68. ¬øQu√© tipo de preguntas son clave para crear la necesidad de la oferta de 2000 megas en un estudiante?
    **Respuesta:** Preguntas sobre sus h√°bitos de consumo: cu√°ntos son en el piso, si juegan online (PlayStation), si ven streaming (f√∫tbol pirata, etc.).

69. **Completa la frase:** "Esta oferta es una oferta precisamente pensada para estudiantes, donde pueden comprar ustedes los megas mucho m√°s ______ que un cliente veterano de 9,95‚Ç¨".
    **Respuesta:** baratos.

70. ¬øLa instalaci√≥n de la fibra tiene coste para los estudiantes?
    **Respuesta:** No, la instalaci√≥n es sin coste extra.

#### **Secci√≥n 7: T√©cnicas de Venta y Argumentario General**

71. ¬øCu√°l es el objetivo principal de la encuesta inicial?
    **Respuesta:** Detectar qu√© valora m√°s el cliente (precio, calidad, atenci√≥n), conocer su compa√±√≠a actual y si est√° satisfecho, para adaptar el argumentario.

72. Seg√∫n las fuentes, no se vende el producto, se vende...
    **Respuesta:** Lo que el producto hace; el beneficio, el sabor, la soluci√≥n.

73. ¬øC√≥mo se debe responder a la objeci√≥n "Lo tengo que consultar"?
    **Respuesta:** Primero empatizar, luego aislar la objeci√≥n ("¬øes el √∫nico inconveniente?") y finalmente reforzar los beneficios y preguntar por qu√© la otra persona no estar√≠a de acuerdo.

74. ¬øQu√© pregunta se puede hacer a un cliente que dice que PTV es m√°s caro?
    **Respuesta:** "¬øY por qu√© cree usted que somos m√°s caros?" para que el propio cliente deduzca que es por la calidad o el servicio.

75. **Completa la frase:** "Si paga menos es porque le dan ______".
    **Respuesta:** menos.

76. ¬øQu√© es un "cierre alternativo"? Pon un ejemplo.
    **Respuesta:** Ofrecer al cliente dos opciones donde ambas implican una compra. Ejemplo: "¬øPrefiere la instalaci√≥n por la ma√±ana o por la tarde?".

77. ¬øQu√© es un "cierre presuntivo"?
    **Respuesta:** Dar por hecho que el cliente va a contratar y empezar a rellenar el contrato pidiendo sus datos.

78. ¬øPara qu√© se utiliza la etapa de "Deseo" en el modelo AIDAS?
    **Respuesta:** Para generar en el cliente la necesidad y ganas de tener el servicio, explicando los beneficios de forma que se imagine disfrut√°ndolos.

79. Seg√∫n el modelo SONCASE, ¬øqu√© fortaleza de PTV corresponde a la "S" de Seguridad?
    **Respuesta:** Sus m√°s de 40 a√±os de experiencia y la atenci√≥n 24h.

80. Seg√∫n el modelo SONCASE, ¬øqu√© fortaleza de PTV corresponde a la "O" de Orgullo?
    **Respuesta:** La valoraci√≥n de la OCU entre las mejores compa√±√≠as de Espa√±a.

81. ¬øCu√°l es el primer paso para resolver una objeci√≥n?
    **Respuesta:** Escucharla atentamente sin interrumpir.

82. ¬øQu√© significa la frase "La confianza se construye con hechos, no con palabras"?
    **Respuesta:** Es un lema para reforzar que las ventajas de PTV (como la no permanencia) son pruebas tangibles de su compromiso, no solo promesas.

83. ¬øPor qu√© es importante usar un tono de voz seguro y palabras potentes como "grandes diferencias"?
    **Respuesta:** Porque transmiten m√°s fuerza y profesionalidad, captando mejor la atenci√≥n del cliente que un lenguaje d√©bil como "varias diferencias".

84. **Verdadero o Falso:** Al tratar con un cliente, es mejor hablar el 80% del tiempo para explicarle bien todas las ventajas.
    **Respuesta:** Falso.

85. ¬øQu√© se debe hacer si un cliente que viene a darse de baja dice que nunca ha tenido problemas con el servicio?
    **Respuesta:** Se debe usar ese argumento a favor, pregunt√°ndole por qu√© cambiar algo que funciona bien y record√°ndole los valores de la compa√±√≠a que ya conoce.

#### **Secci√≥n 8: Fortalezas Adicionales y Modelo de Gesti√≥n**

86. Adem√°s de los servicios principales, ¬øqu√© ofrece la televisi√≥n de PTV a nivel local?
    **Respuesta:** Canales locales con programaci√≥n sobre la actualidad de la ciudad, producidos por periodistas propios.

87. ¬øQu√© ventaja tiene la red de PTV para televisores antiguos?
    **Respuesta:** Emite en dos frecuencias (anal√≥gica y digital), permitiendo que televisores antiguos sin TDT puedan seguir funcionando sin aparatos adicionales.

88. ¬øCu√°l es la pol√≠tica de PTV respecto a sus clientes cuando mejoran una tarifa?
    **Respuesta:** Se aplica la mejora primero a los clientes actuales, sin que tengan que pedirlo.

89. El modelo de gesti√≥n de PTV se basa en tres pilares que le permiten tener precios competitivos. ¬øCu√°les son?
    **Respuesta:** Red propia, personal propio (no subcontratas) y no realizar grandes campa√±as de publicidad.

90. ¬øQu√© es el "peering" o las conexiones directas que tiene PTV?
    **Respuesta:** Conexiones f√≠sicas directas con los servidores de grandes proveedores de contenido (como Netflix o plataformas de videojuegos) para que el tr√°fico sea m√°s r√°pido y fluido.

91. ¬øQu√© ventaja ofrece este "peering" a los gamers?
    **Respuesta:** Un "ping" (tiempo de respuesta) m√°s bajo, lo que se traduce en una ventaja competitiva en juegos online.

92. ¬øQu√© particularidad se menciona sobre las IPs que utiliza Digi?
    **Respuesta:** Que en gran parte son IPs rumanas, lo que puede afectar a servicios de geolocalizaci√≥n.

93. **Verdadero o Falso:** PTV subcontrata a otras empresas para las instalaciones y el mantenimiento t√©cnico.
    **Respuesta:** Falso.

94. ¬øQu√© lema resume la filosof√≠a de PTV?
    **Respuesta:** "PTV de total confianza".

95. **Completa la frase:** "En PTV no eres un n√∫mero, eres parte de nuestra ______".
    **Respuesta:** comunidad.

96. ¬øQu√© ocurre si un cliente de PTV se da de baja? ¬øC√≥mo se gestiona la sintonizaci√≥n de su TV?
    **Respuesta:** Un t√©cnico va a su casa y le deja la televisi√≥n sintonizada con la antena colectiva, como una muestra de elegancia y buen servicio hasta el final.

97. ¬øCu√°l es una ventaja clave de Zapi para un piso compartido?
    **Respuesta:** Permite hasta 4 usuarios simult√°neos, para que cada persona pueda ver lo que quiera en su propio dispositivo.

98. ¬øQu√© es Zapi Kids?
    **Respuesta:** Una aplicaci√≥n espec√≠fica para ni√±os con contenido bloqueado y adaptado a ellos.

99. **Verdadero o Falso:** Si un cliente necesita configurar una impresora en su red dom√©stica, el servicio t√©cnico de PTV le ayudar√°.
    **Respuesta:** Verdadero.

100. ¬øCu√°l es la principal ventaja que un cliente pierde al irse a una compa√±√≠a low-cost, seg√∫n el argumentario general?
    **Respuesta:** La tranquilidad y la seguridad de tener un servicio completo y una atenci√≥n al cliente real y eficaz que resuelve cualquier problema.
`;
    </script>
</body>
</html>


